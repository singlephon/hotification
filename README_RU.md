# Hotification
[![Latest Version on Packagist](https://img.shields.io/packagist/v/singlephon/hotification.svg?style=flat-square)](https://packagist.org/packages/singlephon/hotification)
[![Total Downloads](https://img.shields.io/packagist/dt/singlephon/hotification.svg?style=flat-square)](https://packagist.org/packages/singlephon/hotification)

`Hotification` — это мощный и гибкий пакет для управления уведомлениями в Laravel-приложениях. Он предоставляет удобный API для отправки уведомлений, добавления наблюдателей и обработки событий.

### Основные функции
- Легкость конфигурации через единственный файл config/hotification.php.
- Расширяемость с помощью кастомных классов отправителей и наблюдателей.
- Мгновенная отправка уведомлений в базу данных.
- Динамическое добавление наблюдателей для моделей.
- Выполнение любой логики при изменения в моделях 

## Установка

1. Установка через Composer:

```bash
composer require singlephon/hotification
```

```bash
php artisan hotification:install
```

2. Регистрация сервис-провайдера, alias-а:

Добавьте провайдера, alias-а в `config/app.php`:

```php
'providers' => [
    # ...
    Singlephon\Hotification\HotificationServiceProvider::class,
],
'aliases' => [
    # ...
    'Hotification' => \Singlephon\Hotification\Hotification::class,
]
```

## Быстрый старт

### Отправка уведомлений

Используйте класс `HotificationSender` для мгновенной отправки уведомлений в базу данных:

```php
use Singlephon\Hotification\Extras\HotificationSender;
use App\Models\User;

(new Hotification())
    ->notify(User::find(1))
    ->icon('exclamation-triangle')
    ->title('Important notification...')
    ->description('Some description...')
    ->url('/app/friends/invitations')
    ->actionable()
    ->send();
```

Это добавляет запись в таблицу `notifications`.

### Автоматизация отправки уведомления

В `Hotification` вы можете использовать наблюдателей для моделей (Observers), чтобы автоматически выполнять действия при определенных событиях, таких как создание, обновление или удаление экземпляра модели. Это позволяет легко интегрировать уведомления и колбеки в стандартные процессы работы с моделями, обеспечивая удобный способ управления поведением приложения.

Основные параметры в `config/hotification.php`:
```php
'models' => [
    # Модели, для которых необходимо регистрировать наблюдателей
],
'scheduled_notifications' => [
    # Настройки для запланированных уведомлений
]
```

#### Использования наблюдателей для моделей:
В приведенном ниже примере показано, как настроить наблюдателей для моделей Post и User с использованием хуков onCreated, onUpdated и onDeleted:

```php
'models' => [

    \App\Models\Post::class => [
        # Отправка уведомления при создании нового поста
        'onCreated' => [ 
            \App\Notifications\PostCreatedNotification::class, # Должен наследовать Singlephon\Hotification\Notifications\AbstractHotification
            function (Post $post) {
                # Колбек, выполняющий произвольную логику при создании поста
                # Например, отправка Push уведомления, логирование или изменение других свойств
            },
        ],
        # Отправка уведомления при обновлении поста
        'onUpdated' => [ 
            \App\Notifications\PostUpdatedNotification::class, 
        ]
    ],
    
    \App\Models\User::class => [
        'onCreated' => [
            function (User $user) {
                # Колбек для выполнения логики при создании нового пользователя
                # Например, отправка приветственного сообщения или регистрация активности
                (new Hotification())
                    ->notify($user)
                    ->icon('check-badge')
                    ->title('Welcome ' . $user->name)
                    ->description('Please continue registration form...')
                    ->url('/app/registration/continue')
                    ->actionable()
                    ->send();
            },
        ],
        # Отправка уведомления при удалении пользователя
        'onDeleted' => [
            \App\Notifications\ByeByeNotification::class, 
            function (User $user) {
                # Колбек для выполнения логики при удаление пользователя
                # Например, отправка уведомление на администратор
            }
        ]
    ]
    
]
```

⚠️ Примечание: Классы уведомления должны наследовать класс `Singlephon\Hotification\Notifications\AbstractHotification`

#### Преимущества использования наблюдателей

- Централизация логики: Позволяет сосредоточить всю логику, связанную с событиями модели, в одном месте.
- Удобство управления: Легко добавить или изменить поведение при событиях, просто обновив конфигурацию наблюдателей.
- Расширяемость: Можно использовать как встроенные уведомления, так и произвольные колбеки, предоставляя большую гибкость в обработке событий.

#### Рекомендации

- Используйте хуки только тогда, когда они действительно необходимы, чтобы избежать ненужного усложнения логики.
- Старайтесь не перегружать один хук слишком большим количеством действий, чтобы не снизить производительность и не усложнить отладку.
- В случаях, когда требуется сложная логика, рекомендуется выносить её в отдельные сервисы или классы, чтобы поддерживать чистоту и читаемость кода.

### Уведомления по расписанию

Секция `scheduled_notifications` в `config/hotification.php` позволяет вам определять задачи, которые должны выполняться по расписанию. Эти задачи могут включать как отправку уведомлений, так и выполнение произвольной логики с использованием колбеков. Данный функционал обеспечивает гибкость и удобство управления задачами по расписанию, упрощая автоматизацию рутинных операций.

```php
'scheduled_notifications' => [
    'weekly_report' => function (Schedule $schedule) {
        $schedule->call(function () {
            (new Hotification())
                    ->notify(User::all())
                    ->icon('check-badge')
                    ->title('Welcome ' . $user->name)
                    ->description('Please continue registration form...')
                    ->url('/app/registration/continue')
                    ->actionable()
                    ->send();
        })->everyWeek(); # Запускается каждую неделю
    },
],
'daily_report' => [
    'events' => [
        \App\Notifications\DailyReportNotification::class, # Отправка уведомления
        function () {
            # Логика выполнения произвольного действия
            # Например, генерация отчета и отправка по почте
        },
    ],
    'schedule' => '0 0 * * *', # Каждый день в полночь
],
```
⚠️ Примечание: Классы уведомления должны наследовать класс `Singlephon\Hotification\Notifications\AbstractHotification`

#### Преимущества использования 'scheduled_notifications'
- Гибкость: Возможность комбинировать уведомления и произвольные колбеки в одной задаче.
- Удобство: Легко добавлять и изменять задачи, используя конфигурационные файлы.
- Автоматизация: Позволяет автоматически выполнять рутинные действия, такие как отправка отчетов или выполнение регулярных обновлений.

#### Рекомендации
- Тестируйте задачи: Убедитесь, что расписания настроены корректно, и задачи выполняются в нужное время.
- Избегайте слишком частых задач: Планируйте задачи с разумными интервалами, чтобы избежать перегрузки системы.
- Используйте колбеки для сложной логики: Если задача требует сложной обработки, выносите эту логику в колбеки или отдельные сервисы.

### Динамическое добавление наблюдателей во время выполнения
Одним из ключевых аспектов использования Hotification является возможность динамического добавления наблюдателей (обработчиков) к моделям непосредственно во время выполнения кода, а не только через конфигурационные файлы. Это обеспечивает высокую гибкость и позволяет программно управлять поведением уведомлений в зависимости от контекста или бизнес-логики.

#### Пример кода
Рассмотрим следующий пример, в котором динамически добавляется наблюдатель для модели `User`:
```php
(new Hotification())
    ->manager()
    ->add(User::class, 
        onUpdated: [function (User $user) {}],
        onCreated: [function (User $user) {}],
        onDeleted: [function (User $user) {}]
    );
```


### Журнал изменений

См. [CHANGELOG](CHANGELOG.md) для получения дополнительной информации о недавних изменениях.

## Внесение вклада

См. [CONTRIBUTING](CONTRIBUTING.md) для получения подробной информации.

### Безопасность

Если вы обнаружите какие-либо проблемы, связанные с безопасностью, отправьте электронное письмо на адрес singlephon@gmail.com вместо использования системы отслеживания ошибок.

## Авторы

- [Рахат Бакытжанов](https://github.com/singlephon)
- [Все участники](../../contributors)

## Лицензия

Лицензия MIT (MIT). Для получения дополнительной информации см. [Файл лицензии](LICENSE.md).
